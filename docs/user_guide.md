# 投资交易复盘分析系统 - 用户手册

## 目录

1. [系统概述](#系统概述)
2. [快速开始](#快速开始)
3. [日常使用](#日常使用)
4. [Dashboard解读](#dashboard解读)
5. [支持券商](#支持券商)
6. [故障排除](#故障排除)

## 系统概述

### 什么是投资交易复盘分析系统？

这是一个专为个人投资者设计的零成本、自动化交易复盘工具。系统采用"扔进文件夹即可自动分析"的极简设计，帮助您：

- **自动解析**券商Excel交易记录
- **精确计算**盈亏和持仓成本（FIFO算法）
- **可视化展示**交易表现和趋势
- **深度分析**交易行为模式

### 核心特性

✅ **极简操作** - 只需将Excel文件放入指定文件夹
✅ **零成本启动** - 完全基于免费工具构建
✅ **自动化处理** - 后台静默运行，无需人工干预
✅ **数据驱动** - 三层指标体系，从概览到细节
✅ **多券商支持** - 适配主流券商Excel格式
✅ **云端访问** - 随时随地查看Dashboard

### 系统架构

```
用户操作 → 文件监控 → Excel解析 → 数据处理 → Dashboard展示
    ↓           ↓          ↓         ↓          ↓
放入文件   定时检查    多券商适配   FIFO计算   可视化分析
```

## 快速开始

### 第一次使用（5分钟设置）

#### 步骤1: 下载和安装

1. **下载项目**
   ```bash
   # 如果使用Git
   git clone <repository-url>
   cd trading-analysis-mvp

   # 或下载ZIP压缩包并解压
   ```

2. **运行安装脚本**
   - **Windows**: 双击 `scripts/install.bat`
   - **macOS/Linux**: 在终端运行 `bash scripts/install.sh`

3. **验证安装**
   - 检查是否出现"安装完成"提示
   - 确认没有错误信息

#### 步骤2: 配置Google API（仅需一次）

> **重要**: 这是MVP版本的必要配置，用于云端数据存储

1. **创建Google Cloud项目**
   - 访问 [Google Cloud Console](https://console.cloud.google.com/)
   - 创建新项目，命名为"Trading Analysis"

2. **启用API**
   - 在"API和服务"中启用：
     - Google Sheets API
     - Google Drive API

3. **创建服务账号**
   - 进入"IAM与管理" → "服务账号"
   - 点击"创建服务账号"
   - 填写信息：
     - 名称：`trading-analysis`
     - 描述：`投资交易复盘系统`
   - 点击"创建并继续"
   - 选择角色：**编辑者**
   - 点击"继续"，然后"完成"

4. **下载密钥文件**
   - 找到刚创建的服务账号
   - 点击"操作" → "管理密钥"
   - 点击"添加密钥" → "创建新密钥"
   - 选择**JSON**格式
   - 下载密钥文件

5. **配置系统**
   - 将下载的JSON文件重命名为 `service_account.json`
   - 放入项目目录的 `backend/credentials/` 文件夹

6. **创建Google Sheets**
   - 访问 [Google Sheets](https://sheets.google.com)
   - 创建新电子表格，命名为"投资交易记录"
   - 点击"共享"按钮
   - 将服务账号邮箱（在JSON文件的`client_email`字段）添加为**编辑者**

#### 步骤3: 启动系统

1. **启动系统**
   - **Windows**: 双击 `scripts/start.bat`
   - **macOS/Linux**: 运行 `bash scripts/start.sh`

2. **验证启动**
   - 应该看到启动信息
   - 系统会显示配置信息
   - 最后显示"系统启动中..."

3. **保持运行**
   - 系统需要在后台持续运行
   - 可以最小化终端窗口
   - 不要关闭窗口

## 日常使用

### 标准使用流程（10秒完成）

#### 每日操作

1. **下载交易记录**
   - 登录券商App或网站
   - 找到"交易记录"或"对账单"
   - 导出Excel格式（推荐.xlsx）

2. **放入监控文件夹**
   - 将Excel文件拖入 `trading_records/` 文件夹
   - 文件名任意，系统会自动识别
   - 支持多个文件同时处理

3. **等待自动处理**
   - 系统每小时自动检查一次
   - 或重启系统立即触发处理
   - 处理完成后可在日志中查看结果

4. **查看分析结果**
   - 打开浏览器
   - 访问 [Google Looker Studio](https://lookerstudio.google.com/)
   - 打开"投资交易记录"报表

### 高级使用技巧

#### 批量导入历史数据

1. **准备文件**
   - 将所有历史Excel文件放入 `trading_records/` 文件夹
   - 确保文件格式正确

2. **触发处理**
   - 重启系统或等待下次定时检查
   - 系统会按时间顺序处理所有文件

3. **验证结果**
   - 检查Google Sheets中的数据
   - 确认交易记录完整

#### 自定义检查频率

修改 `backend/app/config.py` 中的设置：

```python
# 每小时检查一次
CHECK_INTERVAL_HOURS = 1

# 改为每30分钟检查一次
CHECK_INTERVAL_HOURS = 0.5
```

## Dashboard解读

### 访问Dashboard

1. **打开Looker Studio**
   - 访问 [https://lookerstudio.google.com/](https://lookerstudio.google.com/)
   - 登录Google账号

2. **打开报表**
   - 找到"投资交易记录"报表
   - 或使用共享链接

### 三层指标体系

#### 第一层：整体概览（3秒了解）

| 指标 | 说明 | 正常值参考 |
|------|------|-----------|
| 总交易次数 | 累计交易数量 | 因人而异 |
| 总盈亏 | 累计已实现盈亏 | 正数为盈利 |
| 总胜率 | 盈利交易占比 | 50%以上较好 |
| 今日交易 | 当日交易次数 | 了解活跃度 |

#### 第二层：近期表现（趋势分析）

**每日盈亏趋势图**
- **柱状图**: 每日盈亏金额（绿盈红亏）
- **折线图**: 累计盈亏趋势
- **用途**: 识别盈利/亏损周期

**盈亏日历热力图**
- **颜色深浅**: 表示盈亏金额
- **绿色**: 盈利日
- **红色**: 亏损日
- **灰色**: 无交易日

#### 第三层：深度分析（策略优化）

**盈利/亏损TOP5**
```
盈利TOP5                亏损TOP5
┌──────────────┐      ┌──────────────┐
│AAPL  +$1,250 │      │TSLA  -$820   │
│收益率: +8.3% │      │亏损率: -5.2% │
│交易次数: 3次 │      │交易次数: 5次 │
└──────────────┘      └──────────────┘
```

**交易时段分析**
- **热力图**: 显示不同时段的交易表现
- **关键指标**: 交易次数、胜率、平均盈利
- **用途**: 找出最佳交易时段

**持仓周期分布**
- **直方图**: 显示不同持仓周期的表现
- **区间划分**: <1天、1-5天、5-10天、>10天
- **用途**: 优化持仓策略

### 关键指标说明

#### 盈亏指标

- **已实现盈亏**: 已平仓交易的净盈亏
- **浮动盈亏**: 当前持仓的未实现盈亏
- **盈亏比例**: 盈亏金额占投入成本的比例

#### 风险指标

- **最大回撤**: 账户价值的最大跌幅
- **夏普比率**: 风险调整后收益
- **胜率**: 盈利交易占比
- **盈亏比**: 平均盈利与平均亏损的比值

#### 效率指标

- **交易频率**: 单位时间内的交易次数
- **平均持仓天数**: 交易从开仓到平仓的平均时间
- **周转率**: 投资组合的换手率

## 支持券商

### 已测试券商

| 券商 | 格式支持 | 状态 |
|------|----------|------|
| 富途证券 | Excel导出 | ✅ 完全支持 |
| 老虎证券 | Excel导出 | ✅ 完全支持 |
| 雪盈证券 | Excel导出 | ✅ 完全支持 |
| Interactive Brokers | 活动报表 | ✅ 完全支持 |

### 通用格式支持

系统采用智能列名识别技术，支持大部分标准Excel格式：

**必需列**
- 日期（date/日期/成交日期）
- 证券代码（symbol/代码/股票代码）
- 交易方向（action/方向/买卖方向）
- 数量（quantity/数量）
- 价格（price/价格/成交价）

**可选列**
- 证券名称（name/名称/股票名称）
- 手续费（commission/手续费/佣金）
- 账户信息（account/账户）

### 添加新券商支持

如需支持新的券商格式：

1. **提供样本文件**
   - 将样本Excel文件发送给技术支持
   - 注意移除敏感信息

2. **手动映射列名**
   - 查看Excel文件的列名
   - 确保包含必需列
   - 系统会自动识别和映射

## 故障排除

### 常见问题

#### Q1: 系统没有自动导入文件？

**可能原因和解决方案：**

1. **系统未运行**
   - 检查终端窗口是否打开
   - 确认系统显示"启动中..."
   - 重新运行启动脚本

2. **文件位置错误**
   - 确认文件在 `trading_records/` 文件夹
   - 检查文件夹路径是否正确

3. **文件格式不支持**
   - 确认文件为 `.xlsx`、`.xls` 或 `.csv` 格式
   - 尝试重新导出Excel文件

4. **查看详细日志**
   ```bash
   # 查看最新日志
   tail -f backend/logs/trading_system.log

   # Windows用户
   type backend\logs\trading_system.log
   ```

#### Q2: Google Sheets连接失败？

**解决方案：**

1. **检查凭证文件**
   - 确认 `service_account.json` 存在
   - 检查文件格式是否正确

2. **验证API权限**
   - 确认Google Sheets API已启用
   - 检查服务账号权限

3. **测试连接**
   ```python
   # 在backend目录下运行测试
   python -c "
   from app.google_sheets_adapter import GoogleSheetsAdapter
   adapter = GoogleSheetsAdapter('credentials/service_account.json', '投资交易记录')
   print('连接成功')
   "
   ```

#### Q3: Dashboard数据不更新？

**解决步骤：**

1. **手动刷新**
   - 在Looker Studio中点击"刷新"按钮
   - 等待几分钟看是否更新

2. **检查数据源**
   - 打开Google Sheets查看原始数据
   - 确认数据是否正确写入

3. **检查处理状态**
   - 查看系统日志确认处理结果
   - 检查是否有错误信息

#### Q4: 计算的盈亏不准确？

**可能原因：**

1. **手续费未包含**
   - 系统会自动包含手续费
   - 检查Excel文件中手续费列

2. **配对算法问题**
   - 系统使用FIFO（先进先出）算法
   - 确认买入和卖出正确配对

3. **数据质量问题**
   - 检查原始数据是否完整
   - 确认价格和数量正确

### 错误代码说明

| 错误代码 | 说明 | 解决方案 |
|----------|------|----------|
| PARSE_ERROR | Excel解析失败 | 检查文件格式和内容 |
| STORAGE_ERROR | 存储写入失败 | 检查Google Sheets连接 |
| CALC_ERROR | 计算错误 | 检查数据完整性 |
| NETWORK_ERROR | 网络连接失败 | 检查网络连接 |

### 获取帮助

如果遇到无法解决的问题：

1. **查看日志文件**
   - 位置：`backend/logs/trading_system.log`
   - 包含详细的错误信息和处理过程

2. **收集信息**
   - 错误截图
   - 日志文件
   - Excel样本文件（移除敏感信息）

3. **联系支持**
   - 创建Issue在GitHub仓库
   - 发送邮件到技术支持邮箱

---

**祝您投资顺利，交易盈利！** 📈💰